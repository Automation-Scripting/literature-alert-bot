name: arXiv â†’ Discord

on:
  schedule:
    - cron: "0 8 * * *"   # daily at 08:00 UTC = 05:00 BRT (UTC-3)
  workflow_dispatch:
    inputs:
      only_topic:
        description: "Run only this topic id (default: all)"
        required: false
        default: "all"
        type: string
      time_frame:
        description: "Days back (default: 1) or 'all'"
        required: false
        default: "1"
        type: string

jobs:
  run-scripts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install feedparser requests pyyaml

      - name: Run HEP topics via runner
        env:
          TIME_FRAME: ${{ github.event.inputs.time_frame || '1' }}
          ONLY_TOPIC: ${{ github.event.inputs.only_topic || 'all' }}

          DISCORD_WEBHOOK_URL_BARYOGENESIS: ${{ secrets.DISCORD_HEP_EARLY_UNIVERSE_BARYOGENESIS_WEBHOOK }}
          DISCORD_WEBHOOK_URL_QGP_ML: ${{ secrets.DISCORD_HEP_QGP_ML_WEBHOOK }}
          DISCORD_WEBHOOK_URL_QGP_NN: ${{ secrets.DISCORD_HEP_QGP_NEURAL_WEBHOOK }}
          DISCORD_WEBHOOK_URL_QGP_BAYESIAN: ${{ secrets.DISCORD_HEP_QGP_BAYESIAN_INFERENCE_WEBHOOK }}
          DISCORD_WEBHOOK_URL_QGP_DKL: ${{ secrets.DISCORD_HEP_QGP_DEEP_KERNEL_LEARNING_WEBHOOK }}
          DISCORD_WEBHOOK_URL_NUCL_EX: ${{ secrets.DISCORD_HEP_NUCLEAR_EXPERIMENT_WEBHOOK }}
          DISCORD_WEBHOOK_URL_NUCL_TH: ${{ secrets.DISCORD_HEP_NUCLEAR_THEORY_WEBHOOK }}
          DISCORD_WEBHOOK_URL_HEP_LAT: ${{ secrets.DISCORD_HEP_LATTICE_WEBHOOK }}
          DISCORD_WEBHOOK_URL_HEP_TH: ${{ secrets.DISCORD_HEP_THEORY_WEBHOOK }}
          DISCORD_WEBHOOK_URL_HEP_PH: ${{ secrets.DISCORD_HEP_PHENOMENOLOGY_WEBHOOK }}
          DISCORD_WEBHOOK_URL_HEP_EX: ${{ secrets.DISCORD_HEP_EXPERIMENT_WEBHOOK }}

        run: python runner.py topics/hep.yml

      - name: Run STAT topics via runner
        env:
          TIME_FRAME: ${{ github.event.inputs.time_frame || '1' }}
          ONLY_TOPIC: ${{ github.event.inputs.only_topic || 'all' }}

          DISCORD_WEBHOOK_URL_STAT_ML: ${{ secrets.DISCORD_STAT_MACHINE_LEARNING_WEBHOOK }}
          DISCORD_WEBHOOK_URL_STAT_TH: ${{ secrets.DISCORD_STAT_THEORY_WEBHOOK }}
          DISCORD_WEBHOOK_URL_STAT_ME: ${{ secrets.DISCORD_STAT_METODOLOGY_WEBHOOK }}
          DISCORD_WEBHOOK_URL_STAT_AP: ${{ secrets.DISCORD_STAT_APPLICATIONS_WEBHOOK }}
          DISCORD_WEBHOOK_URL_STAT_CO: ${{ secrets.DISCORD_STAT_COMPUTATION_WEBHOOK }}
          DISCORD_WEBHOOK_URL_STAT_OT: ${{ secrets.DISCORD_STAT_OTHER_WEBHOOK }}
          DISCORD_WEBHOOK_URL_MATH_ST: ${{ secrets.DISCORD_MATH_STATISTICS_WEBHOOK }}
          DISCORD_WEBHOOK_URL_CS_LG: ${{ secrets.DISCORD_CS_MACHINE_LEARNING_WEBHOOK }}
          DISCORD_WEBHOOK_URL_CS_AI: ${{ secrets.DISCORD_CS_ARTIFICIAL_INTELIGENCE_WEBHOOK }}

        run: python runner.py topics/stat.yml
